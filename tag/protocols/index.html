<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Posts Tagged - protocols | Phil Yates &mdash; Lead iOS Engineer and Manager </title>
    <meta property="og:title" content="Posts Tagged - protocols | Phil Yates &mdash; Lead iOS Engineer and Manager " />
    <meta name="twitter:title" content="Posts Tagged - protocols | Phil Yates &mdash; Lead iOS Engineer and Manager " />

    <meta name="description" content="Has been building software for over 15 years! Looking to share some of the knowledge picked up along the way.">
    <meta name="twitter:description" content="Has been building software for over 15 years! Looking to share some of the knowledge picked up along the way." />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@pyates" />
    
    <meta property="og:url" content="https://pyartez.github.io/tag/protocols/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Phil Yates" />

    <meta name="copyright" content="Copyright by Phil Yates. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="https://pyartez.github.io/assets/css/main.css">

    <link rel="canonical" href="https://pyartez.github.io/tag/protocols/">

    <link rel="alternate" type="application/rss+xml" title="" href="https://pyartez.github.io/feed.xml">

    <script data-ad-client="ca-pub-6959344114005358" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="https://pyartez.github.io"><img alt="Avatar" src="http://www.gravatar.com/avatar/ab24a8a6753036f939b5c8d4b9de9941?s=400" /></a>
        <div class="my-info">
            <h1><strong class="my-name">Phil Yates</strong></h1>
            <span class="my-job-title">Lead iOS Engineer and Manager</span>
        </div>
    </div>

    <!-- 
        
        <div class="mainmenu">
            <a href="https://pyartez.github.io" >Home</a>
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
     -->

    <p class="about-me">Has been building software for over 15 years! Looking to share some of the knowledge picked up along the way.</p>

    <ul class="socials">
        <li><a href="https://twitter.com/pyates"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://www.linkedin.com/in/phil-yates-06486727"><svg title="linkedin" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#linkedin-icon"></use></svg></a></li><li><a href="https://github.com/pyartez"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        

        
         <li><a href="https://pyartez.github.io/feed.xml"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>

<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{clear:left; margin-top: 20px}
    /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
    #mc_embed_signup input.email { width: 100% }
    #mc_embed_signup .button { background-color: #FF5B78 }
</style>
<div id="mc_embed_signup">
<form action="https://github.us10.list-manage.com/subscribe/post?u=83e03da2b78f9036b74a6f6a1&amp;id=7aa3365d6b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">Subscribe</label>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_83e03da2b78f9036b74a6f6a1_7aa3365d6b" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->
</aside>

            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <h1>Posts Tagged - protocols</h1>


    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2020-06-03T10:00:00+01:00" itemprop="datePublished">3 Jun, 2020</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/type-erasure/">type-erasure</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/type-erasure/what-is-type-erasure.html">What is type erasure in Swift</a></h2>
            </header>

            <div class="post-content">
                <h2 id="intro">Intro</h2>

<ul>
  <li>Wtf is type erasure?</li>
  <li>Why do I need it?</li>
  <li>This seems complicated?</li>
  <li>Isn’t there a simpler way?</li>
</ul>

<p>These are are just some of the questions I found myself asking once I first starting exploring type erasure. Like many other developers, I have been making use of protocols in my code to remove dependencies and make my classes easy to unit test. It wasn’t until I then started to add generics to my protocols that I discovered the need to apply type erasure.</p>

<p>Having read many blog posts and guides about type erasure I still came away confused as to what it was, why it was needed and why it seemed to add so much complexity. By trying to add generics to protocols in a project I was working on I finally saw the light! I am going to try and walk you through the topic using an example which is similar to the one I was trying to solve in my project. Hopefully this will help those of you who are looking to understand the topic further in the same way it helped me.</p>

<h2 id="generics-and-associated-types">Generics and Associated Types</h2>

<p>I am assuming that as you are here you have a fairly advanced knowledge of Swift and have potentially begun or have been using protocols with generics in your code. Below is a simple protocol called Fetchable. The idea of the protocol is to go and fetch some objects of type FetchType from somewhere and call the completion handler with the result once it’s finished whatever it is doing.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="kt">Fetchable</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">FetchType</span>

    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">((</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">FetchType</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span>
<span class="p">}</span></code></pre></figure>

<p>Now that we have our protocols lets create a couple of structs to implement the protocol.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">UserFetch</span><span class="p">:</span> <span class="kt">Fetchable</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">FetchType</span> <span class="o">=</span> <span class="kt">User</span>

    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">((</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">FetchType</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">User</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Phil"</span><span class="p">)</span>
        <span class="nf">completion</span><span class="p">?(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So here we have created a dummy data class, User. Our fetch struct has implemented the generic protocol and has specified the type of object that will be returned in the protocol using a typealias. Everything here is great, we can implement this protocol as many times as we like and return whatever object types we want without the need to create a new protocol for each one.</p>

<h2 id="the-problem">The problem</h2>

<p>Now, here in lies the problem. If we wish to hold a reference to an object that has implemented this protocol. How do we know what type it is going to return? See the below example:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">SomeStruct</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">userFetch</span><span class="p">:</span> <span class="kt">Fetchable</span>
<span class="p">}</span></code></pre></figure>

<p>What you will also find here is that you will see an error, something like the below</p>

<blockquote>
  <p>Protocol ‘Fetchable’ can only be used as a generic constraint because it has Self or associated type requirements</p>
</blockquote>

<p>So we can’t even use this type as a reference to the object, as it has an associated type which we cannot see at this point and have no way of specifying.</p>

<p>Now we could do something like below, however this creates a dependency between SomeStruct and the userFetch object. If we are following the SOLID principles we want to avoid having dependencies and hide implementation details.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">SomeStruct</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">userFetch</span><span class="p">:</span> <span class="kt">UserFetch</span>
<span class="p">}</span></code></pre></figure>

<p>Ok, so let’s try adding a type like we do with other generic types such as arrays and dictionaries:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">SomeStruct</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">userFetch</span><span class="p">:</span> <span class="kt">Fetchable</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span>
<span class="p">}</span></code></pre></figure>

<p>If you try the above you will probably end up with an error something like this:</p>

<blockquote>
  <p>Cannot specialize non-generic type ‘Fetchable’</p>
</blockquote>

<p>See generic protocols, unlike generic types cannot have their type inferred in the type declaration. The type is only specified during implementation.</p>

<h3 id="type-erasure-to-the-rescue">Type Erasure to the rescue</h3>

<p>So this is where type erasure comes in. In order for us to know the type returned we need to implement a new class that can be used to infer the type of object returned so that we know what to expect when we call fetch.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">struct</span> <span class="kt">AnyFetchable</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Fetchable</span> <span class="p">{</span>
    <span class="c1">// 2</span>
    <span class="kd">typealias</span> <span class="kt">FetchType</span> <span class="o">=</span> <span class="kt">T</span>

    <span class="c1">// 3</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">_fetch</span><span class="p">:</span> <span class="p">(((</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span>

    <span class="c1">// 4</span>
    <span class="kd">init</span><span class="o">&lt;</span><span class="kt">U</span><span class="p">:</span> <span class="kt">Fetchable</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">fetchable</span><span class="p">:</span> <span class="kt">U</span><span class="p">)</span> <span class="k">where</span> <span class="kt">U</span><span class="o">.</span><span class="kt">FetchType</span> <span class="o">==</span> <span class="kt">T</span> <span class="p">{</span>
        <span class="n">_fetch</span> <span class="o">=</span> <span class="n">fetchable</span><span class="o">.</span><span class="n">fetch</span>
    <span class="p">}</span>

    <span class="c1">// 5</span>
    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">((</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span> <span class="p">{</span>
        <span class="nf">_fetch</span><span class="p">(</span><span class="n">completion</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Whoooa! There is a lot going on here so let us go through it piece by piece to explain what is happening.</p>

<ol>
  <li>Here our AnyFetchable class is implementing the Fetchable protocol. But also we see that we now have a generic type specification. This means that we can specify what type is being used while storing a reference to this struct.</li>
  <li>Our generic type T being specified in the line above is then used in the typealias and mapped to the FetchType associated value of the protocol.</li>
  <li>Now this is where things get fiddly. In order for us to erase the type of the injected class we must first <strong>create an attribute which is a closure with a matching signature for each function in the protocol</strong>. In this scenario we only have 1 method which is the fetch method. Here you can see the fetch attribute has the same method signature as the one in the protocol.</li>
  <li>Lets break this down a bit. First of all we are saying that this init method is only available for an object that has implemented Fetchable, called U. The where clause at the end of the line is a generic type restriction which states that the FetchType of the Fetchable U must be the same as the one being used in this class. This might not make too much sense right now, but stay with me. When the fetchable type U is passed in, we store a reference to its fetch method in our own internal variable. This is what helps us erase the type, we store a reference to all of the objects methods without actually storing a reference to the object. That way we don’t need to know the type.</li>
  <li>Here is our implementation of the Fetchable protocols fetch method, however all we are doing is calling the reference to passed in objects fetch method and calling that instead.</li>
</ol>

<p>Hopefully some of this makes sense, some of this may be new or confusing especially point 4. Let’s show how we can use our class in this example.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">SomeStruct</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">userFetch</span><span class="p">:</span> <span class="kt">AnyFetchable</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="c1">// 1</span>
<span class="k">let</span> <span class="nv">userFetch</span> <span class="o">=</span> <span class="kt">UserFetch</span><span class="p">()</span>

<span class="c1">// 2</span>
<span class="k">let</span> <span class="nv">anyFetchable</span> <span class="o">=</span> <span class="kt">AnyFetchable</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span><span class="p">(</span><span class="n">userFetch</span><span class="p">)</span>

<span class="c1">// 3</span>
<span class="k">let</span> <span class="nv">someStruct</span> <span class="o">=</span> <span class="kt">SomeStruct</span><span class="p">(</span><span class="nv">userFetch</span><span class="p">:</span> <span class="n">anyFetchable</span><span class="p">)</span>

<span class="c1">// 4</span>
<span class="n">someStruct</span><span class="o">.</span><span class="n">userFetch</span><span class="o">.</span><span class="n">fetch</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<ol>
  <li>First we create an instance of our UserFetch object from earlier in the example that returns our example user.</li>
  <li>We pass this into our AnyFetchable object. Now remember we had a generic type constraint on our init in point 4 of the previous example. This is being satisfied because we have specified that the AnyFetchable should return a User type, and the UserFetch object we are passing in has the FetchType User.</li>
  <li>We can now pass in the AnyFetchable to our struct.</li>
</ol>

<h3 id="why">Why?</h3>

<p>Now you are probably thinking, why do all of this? Well, let’s try another example:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// New Dave user struct</span>
<span class="kd">struct</span> <span class="kt">DaveFetch</span><span class="p">:</span> <span class="kt">Fetchable</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">FetchType</span> <span class="o">=</span> <span class="kt">User</span>

    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">((</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">FetchType</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">User</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"Dave"</span><span class="p">)</span>
        <span class="nf">completion</span><span class="p">?(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Example implementation 2</span>
<span class="k">let</span> <span class="nv">daveFetch</span> <span class="o">=</span> <span class="kt">DaveFetch</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">anyDaveFetchable</span> <span class="o">=</span> <span class="kt">AnyFetchable</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;</span><span class="p">(</span><span class="n">daveFetch</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">someDaveStruct</span> <span class="o">=</span> <span class="kt">SomeStruct</span><span class="p">(</span><span class="nv">userFetch</span><span class="p">:</span> <span class="n">anyDaveFetchable</span><span class="p">)</span>

<span class="n">someDaveStruct</span><span class="o">.</span><span class="n">userFetch</span><span class="o">.</span><span class="n">fetch</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">user</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So here we have created a new object that implements Fetchable and returns a user called Dave. We can then pass this into our SomeStruct using our type erasure class and it works exactly the same. The SomeStruct class doesn’t need to be changed in order to work with the new dave class as it’s type has been erased. In a production app we could inject any class we want as long as it fetches a User, whether that comes from the web, core data, the file system. It doesn’t matter we could switch it at any time without making changes to our SomeStruct class.</p>

<h3 id="finally">Finally</h3>

<p>The last example here is that we can use our Any class for other types, not just User. See the example below:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Product Type</span>
<span class="kd">struct</span> <span class="kt">Product</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">price</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ProductFetch</span><span class="p">:</span> <span class="kt">Fetchable</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">FetchType</span> <span class="o">=</span> <span class="kt">Product</span>

    <span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">((</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">FetchType</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">product</span> <span class="o">=</span> <span class="kt">Product</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"My Product"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="s">"10.99"</span><span class="p">)</span>
        <span class="nf">completion</span><span class="p">?(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">product</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">productFetch</span> <span class="o">=</span> <span class="kt">ProductFetch</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">anyProductFetch</span> <span class="o">=</span> <span class="kt">AnyFetchable</span><span class="o">&lt;</span><span class="kt">Product</span><span class="o">&gt;</span><span class="p">(</span><span class="n">productFetch</span><span class="p">)</span>
<span class="n">anyProductFetch</span><span class="o">.</span><span class="n">fetch</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">product</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Similar to our user example, we have created a new Product object and a fetcher that returns a product object. However we can re-use our AnyFetchable here but specifying the return type as Product.</p>

<p>There is a lot to cover and understand here and hopefully this helps make some sense of type erasure and what it is used for. More importantly how to implement your own Any type erasure class for your own protocols so that they can be referenced in your code.</p>

<p><a href="https://github.com/pyartez/blog-samples">Download the playground</a> and play around with the examples yourself</p>


                
                    <p><a href="/type-erasure/what-is-type-erasure.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=What is type erasure in Swift&p[summary]=Intro


  Wtf is type erasure?
  Why do I need it?
  This seems complicated?
  Isn’t there a simpler way?


These are are just some of th...&p[url]=https://pyartez.github.io/type-erasure/what-is-type-erasure.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/type-erasure/what-is-type-erasure.html&text=Intro


  Wtf is type erasure?
  Why do I need it?
  This seems complicated?
  Isn’t there a simpler way?


These are are just some of th...&hashtags=swift,advanced,protocols,generics," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/advanced">advanced</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/protocols">protocols</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/generics">generics</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        
    
        
    

            </main>
        </div>

        <script src="https://pyartez.github.io/assets/js/jquery-1.12.2.min.js"></script>
<script src="https://pyartez.github.io/assets/js/backtotop.js"></script>
<script src="https://pyartez.github.io/assets/js/lunr.min.js"></script>
<script src="https://pyartez.github.io/assets/js/lunr-feed.js"></script>
<script src="https://pyartez.github.io/assets/js/jquery.fitvids.js"></script>
<script src="https://pyartez.github.io/assets/js/svg4everybody.min.js"></script>
<script src="https://pyartez.github.io/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-163798308-1', 'auto');
        ga('send', 'pageview');
    </script>

    </body>
</html>