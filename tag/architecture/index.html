<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Posts Tagged - architecture | Phil Yates &mdash; Mobile Engineer and Engineering Manager </title>
    <meta property="og:title" content="Posts Tagged - architecture | Phil Yates &mdash; Mobile Engineer and Engineering Manager " />
    <meta name="twitter:title" content="Posts Tagged - architecture | Phil Yates &mdash; Mobile Engineer and Engineering Manager " />

    <meta name="description" content="Has been building software for over 17 years! Looking to share some of the knowledge picked up along the way.">
    <meta name="twitter:description" content="Has been building software for over 17 years! Looking to share some of the knowledge picked up along the way." />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@pyates" />
    
    <meta property="og:url" content="https://pyartez.github.io/tag/architecture/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Phil Yates" />

    <meta name="copyright" content="Copyright by Phil Yates. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="https://pyartez.github.io/assets/css/main.css">

    <link rel="canonical" href="https://pyartez.github.io/tag/architecture/">

    <link rel="alternate" type="application/rss+xml" title="" href="https://pyartez.github.io/feed.xml">

    <script data-ad-client="ca-pub-6959344114005358" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7CNTV430MK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7CNTV430MK');
    </script>
</head>

    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="https://pyartez.github.io"><img alt="Avatar" src="http://www.gravatar.com/avatar/ab24a8a6753036f939b5c8d4b9de9941?s=400" /></a>
        <div class="my-info">
            <h1><strong class="my-name">Phil Yates</strong></h1>
            <span class="my-job-title">Mobile Engineer and Engineering Manager</span>
        </div>
    </div>

    <!-- 
        
        <div class="mainmenu">
            <a href="https://pyartez.github.io" >Home</a>
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
     -->

    <p class="about-me">Has been building software for over 17 years! Looking to share some of the knowledge picked up along the way.</p>

    <ul class="socials">
        <li><a href="https://twitter.com/pyates"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://www.linkedin.com/in/phil-yates-06486727"><svg title="linkedin" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#linkedin-icon"></use></svg></a></li><li><a href="https://github.com/pyartez"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        

        
         <li><a href="https://pyartez.github.io/feed.xml"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>

<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{clear:left; margin-top: 20px}
    /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
    #mc_embed_signup input.email { width: 100% }
    #mc_embed_signup .button { background-color: #FF5B78 }
</style>
<div id="mc_embed_signup">
<form action="https://github.us10.list-manage.com/subscribe/post?u=83e03da2b78f9036b74a6f6a1&amp;id=7aa3365d6b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <label for="mce-EMAIL">Subscribe</label>
    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_83e03da2b78f9036b74a6f6a1_7aa3365d6b" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<!-- Left hand column -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8297101226"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--End mc_embed_signup-->
</aside>

            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <h1>Posts Tagged - architecture</h1>


    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2023-05-09T06:00:00+01:00" itemprop="datePublished">9 May, 2023</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/architecture/">architecture</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/architecture/solid-principles-in-swift-dependency-inversion-principle.html">SOLID Principles in Swift - Dependency Inversion Principle</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principles / guidelines, that when followed when developing a software system, make it more likely that the system will be easier to extend and maintain over time. Let’s take a look at the problems that they seek to solve:</p>

<ul>
  <li>Fragility: A change may break unexpected parts, it is very difficult to detect if you don’t have a good test coverage</li>
  <li>Immobility: A component is difficult to reuse in another project or in multiple places of the same project because it has too many coupled dependencies</li>
  <li>Rigidity: A change requires a lot of effort because it affects several parts of the project</li>
</ul>

<p>So what are the SOLID principles?</p>

<ul>
  <li>Single Responsibility Principle - A class should have only a single responsibility / have only one reason to change</li>
  <li>Open-Closed Principle - Software should be open for extension but closed for modification</li>
  <li>Liskov Substitution Principle - Objects in a program should be replaceable with instances of their sub types without altering the correctness of the program</li>
  <li>Interface Segregation Principle - Many client-specific interfaces are better than one general-purpose interface</li>
  <li>Dependency Inversion Principle - High level modules should not depend on low level modules. Both should depend on abstractions</li>
</ul>

<p>In this article we will focus on the Dependency Inversion Principle.</p>

<h2 id="what-does-it-mean">What does it mean?</h2>

<p>This principle has 2 main components described below:</p>

<blockquote>
  <p>High-level modules should not import anything from low-level modules. Both should depend on abstractions (e.g., interfaces)
Abstractions should not depend on details. Details (concrete implementations) should depend on abstractions</p>
</blockquote>

<p>I’ve interviewed many iOS developers over the years and I struggle to recall a single person who has actually got this part of the SOLID principles 100% right. I think a large part of this comes from the fact many use simple architectures such as MVVM that don’t break applications down into smaller layers and components/modules. This isn’t a criticism, not every app needs a VIPER/Clean architecture approach with multiple layers.</p>

<p>Most iOS developers I speak to come to the conclusion that this principle just means using protocols instead of concrete classes and injecting dependencies to help with testing/mocking. While this principle does rely on this to work it is not the primary purpose of the principle and exposes an issue once you start to depend on abstractions used across multiple layers / modules.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="setup">Setup</h2>

<p>Lets setup a simple example in Xcode where we have two separate modules that depend on each other in order to provide some functionality.</p>

<p>If we create a simple Swift UI project using Xcode, then using File -&gt; New -&gt; Package create 2 new swift packages and add them to the project. One called LibraryA and one called LibraryB. Be sure to select your project in the ‘Add to’ drop down when naming your libraries. You should have something that looks like below Xcode.</p>

<p><img src="/assets/images/packages-setup.png" alt="Swift Packages Setup" title="Swift Packages Setup" /></p>

<p>Let’s start by adding a protocol and some custom data structure that we are going to be using across the 2 libraries we are working. Add a file called Protocol.swift in LibraryA and add the following code below:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">MyProtocol</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">MyData</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">MyData</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="kd">public</span> <span class="k">let</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>We have a simple one function protocol and a small struct, this is what we will be using to separate dependencies between our 2 libraries.</p>

<p>Next, lets create an implementation in LibraryA that has these protocols as a dependency. Create a file in LibraryA with the name ImplementationA:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">ImplementationA</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">something</span><span class="p">:</span> <span class="kt">MyProtocol</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">something</span><span class="p">:</span> <span class="kt">MyProtocol</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">something</span> <span class="o">=</span> <span class="n">something</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This is just a simple class that has the MyProtocol protocol has a dependency. Simple enough so far!</p>

<p>Now let’s create a class in LibraryB that implements the protocol that is being used in our class in LibraryA. Create a class in LibraryB called ImplementationB:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">LibraryA</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">ImplementationB</span><span class="p">:</span> <span class="kt">MyProtocol</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">LibraryA</span><span class="o">.</span><span class="kt">MyData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Do something"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>We have our class in LibraryB that is implementing the protocol we previously created in LibraryA. For this reason you will notice that we have to import LibraryA in this class as well. There is one additional step we need to do before this will compile correctly, we need to define our dependency in our package file. Let’s open the LibraryB package file and edit it to add the dependency between the 2 packages:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
    <span class="nv">products</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">library</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
            <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="c1">// Assign LibraryA as dependency</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"../LibraryA"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
            <span class="c1">// Add dependency to target</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryA"</span><span class="p">]),</span>
        <span class="o">.</span><span class="nf">testTarget</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryBTests"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

<p>We won’t go into all the options you need in the swift package file but hopefully by reading this you can see we have defined a dependency and added it to our LibraryB target. If you attempt to build the project it should compile successfully.</p>

<p>Now let’s look at the structure of these 2 libraries and their relationship to each other.</p>

<p><img src="/assets/images/libraryb-to-a.png" alt="LibraryB to LibraryA Dependency" title="LibraryB to LibraryA Dependency" /></p>

<p>As you can see, we have LibraryA, this contains the protocols and LibraryB that implements the protocols. In order for LibraryB to implement the protocols it needs a dependency to LibraryA in order to work.</p>

<h2 id="problem-1">Problem 1</h2>

<p>Now what happens if we want to use the protocols in another Library? Let’s call this LibraryC? At moment the protocols are contained in LibraryA where they are being used and implemented by Library B.</p>

<ul>
  <li>We can’t use the protocols in another library without adding LibraryA which may contain code and other assets we don’t want.</li>
  <li>We could copy the protocols to LibraryC, however if you needed LibraryA and LibraryC in the same project you would get class clashes.</li>
  <li>We would need to edit LibraryB to add another dependency in this case. What happens if we are not the owners of LibraryB? How would we even do this?</li>
</ul>

<p>One solution we can try is moving the protocols from LibraryA to LibraryB. This reverses the dependencies and helps to solve the problems highlighted above. Let’s go ahead and do this now.</p>

<ul>
  <li>Copy the Protocols.swift file we created from LibraryA to LibraryB</li>
  <li>Remove the import of LibraryA from the implementationB.swift</li>
</ul>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">ImplementationB</span><span class="p">:</span> <span class="kt">MyProtocol</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">MyData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Do something"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li>Add an import of LibraryB to the top of implementationA.swift</li>
</ul>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">LibraryB</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">ImplementationA</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">something</span><span class="p">:</span> <span class="kt">MyProtocol</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">something</span><span class="p">:</span> <span class="kt">MyProtocol</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">something</span> <span class="o">=</span> <span class="n">something</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li>Update the LibraryB package file to remove the LibraryA dependency</li>
</ul>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
    <span class="nv">products</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">library</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
            <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="c1">// Assign LibraryA as dependency</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
            <span class="c1">// Add dependency to target</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[]),</span>
        <span class="o">.</span><span class="nf">testTarget</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryBTests"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

<ul>
  <li>Update the LibraryA package file to add the LibraryB dependency</li>
</ul>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryA"</span><span class="p">,</span>
    <span class="nv">products</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Products define the executables and libraries a package produces, and make them visible to other packages.</span>
        <span class="o">.</span><span class="nf">library</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryA"</span><span class="p">,</span>
            <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryA"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Dependencies declare other packages that this package depends on.</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"../LibraryB"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Targets are the basic building blocks of a package. A target can define a module or a test suite.</span>
        <span class="c1">// Targets can depend on other targets in this package, and on products in packages this package depends on.</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryA"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
        <span class="o">.</span><span class="nf">testTarget</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryATests"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryA"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

<p>Now let’s see a diagram of what we have done. Now if we look at our 2 libraries at a high level the dependencies look like this.</p>

<p><img src="/assets/images/librarya-to-b.png" alt="LibraryA to LibraryB Dependency" title="LibraryA to LibraryB Dependency" /></p>

<p>So now, our LibraryA has a dependency on LibraryB. LibraryA is using the protocols that are defined AND implemented in LibraryB! Problem solved… right… Not entirely.</p>

<p>If we review the problems we discussed earlier, if LibraryC wanted to make use of the protocols and implementation in LibraryB that is now possible as LibraryB has no knowledge of LibraryA or LibraryC. However this creates a new problem…</p>

<h2 id="problem-2">Problem 2</h2>

<p>What if LibraryA and LibraryC want to use different implementations of the protocols from each other? What if we introduced LibraryD that wanted to implement the protocols and be used by another library such as LibraryC? In order to facilitate this we would need to create a dependency between LibraryD and LibraryB. What problems does this create?</p>

<p>We are introducing a dependency to a library we don’t need, in order to implement the protocols within it. In our example there isn’t much in LibraryB but imagine LibraryB had lots of other code and its own dependencies? Now we are including all of those in our project in order to have access to the protocols.</p>

<p><img src="/assets/images/librarya-to-b-problems.png" alt="LibraryA to LibraryB Dependency Problems" title="LibraryA to LibraryB Dependency Problems" /></p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="solution">Solution</h2>

<p>This is where Dependency Inversion comes in. What we need to do is create a separate library for the protocols and any data that passes through them. Then, we make the dependencies between our different libraries to that one, thus removing the dependencies between our different layers. Let’s do that now.</p>

<ul>
  <li>Create a new package and add it to your project, naming it Protocols. Now move the Protocols.swift file that we created earlier into the Protocols package. Your Xcode project file explorer should look like below:</li>
</ul>

<p><img src="/assets/images/packages-protocol-setup.png" alt="Protocols in own package" title="Protocols in own package" /></p>

<ul>
  <li>Now lets edit the dependencies of our packages so that both LibraryA and LibraryB depend on protocols. Your package files for LibraryA and B should now look like the below:</li>
</ul>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryA"</span><span class="p">,</span>
    <span class="nv">products</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Products define the executables and libraries a package produces, and make them visible to other packages.</span>
        <span class="o">.</span><span class="nf">library</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryA"</span><span class="p">,</span>
            <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryA"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Dependencies declare other packages that this package depends on.</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"../Protocols"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Targets are the basic building blocks of a package. A target can define a module or a test suite.</span>
        <span class="c1">// Targets can depend on other targets in this package, and on products in packages this package depends on.</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryA"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"Protocols"</span><span class="p">]),</span>
        <span class="o">.</span><span class="nf">testTarget</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryATests"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryA"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
    <span class="nv">products</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Products define the executables and libraries a package produces, and make them visible to other packages.</span>
        <span class="o">.</span><span class="nf">library</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
            <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Dependencies declare other packages that this package depends on.</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="s">"../Protocols"</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// Targets are the basic building blocks of a package. A target can define a module or a test suite.</span>
        <span class="c1">// Targets can depend on other targets in this package, and on products in packages this package depends on.</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryB"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"Protocols"</span><span class="p">]),</span>
        <span class="o">.</span><span class="nf">testTarget</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"LibraryBTests"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LibraryB"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span></code></pre></figure>

<ul>
  <li>Now update the imports of your implementation files so that they import Protocols instead. Your implementation files should look like the below:</li>
</ul>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">Protocols</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">ImplementationA</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">something</span><span class="p">:</span> <span class="kt">MyProtocol</span>
    
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">something</span><span class="p">:</span> <span class="kt">MyProtocol</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">something</span> <span class="o">=</span> <span class="n">something</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">Protocols</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="kt">ImplementationB</span><span class="p">:</span> <span class="kt">MyProtocol</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{}</span>
    
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">MyData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Do something"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Let’s have a look at what we have done here. We have moved the dependencies between the layers into a separate package and are now pointing both sides at that rather than one way or the other. Let’s update our diagram to show how this helps us.</p>

<p><img src="/assets/images/dependency-inversion.png" alt="Dependency Inversion" title="Dependency Inversion" /></p>

<p>Now if we want to use LibraryA, B, C, or D it does not matter in our dependency graph. They all point to the protocols and data and can be used interchangeably without the need to modify the libraries, so they depend on each other. We also avoid importing any unnecessary classes that we don’t need in order to satisfy the dependencies.</p>

<p>This is what dependency inversion is. It’s separating protocols and data dependencies from the dependencies themselves and putting them into their own package. This way you completely separate the layers from each other, and they can be used together without any knowledge of each other. Awesome!</p>


                
                    <p><a href="/architecture/solid-principles-in-swift-dependency-inversion-principle.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SOLID Principles in Swift - Dependency Inversion Principle&p[summary]=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&p[url]=https://pyartez.github.io/architecture/solid-principles-in-swift-dependency-inversion-principle.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/architecture/solid-principles-in-swift-dependency-inversion-principle.html&text=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&hashtags=swift,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2022-05-03T06:00:00+01:00" itemprop="datePublished">3 May, 2022</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/architecture/">architecture</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/architecture/solid-principles-in-swift-interface-segragation-principle.html">SOLID Principles in Swift - Interface Segragation Principle</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principles / guidelines, that when followed when developing a software system, make it more likely that the system will be easier to extend and maintain over time. Let’s take a look at the problems that they seek to solve:</p>

<ul>
  <li>Fragility: A change may break unexpected parts, it is very difficult to detect if you don’t have a good test coverage</li>
  <li>Immobility: A component is difficult to reuse in another project or in multiple places of the same project because it has too many coupled dependencies</li>
  <li>Rigidity: A change requires a lot of effort because it affects several parts of the project</li>
</ul>

<p>So what are the SOLID principles?</p>

<ul>
  <li>Single Responsibility Principle - A class should have only a single responsibility / have only one reason to change</li>
  <li>Open-Closed Principle - Software should be open for extension but closed for modification</li>
  <li>Liskov Substitution Principle - Objects in a program should be replaceable with instances of their sub types without altering the correctness of the program</li>
  <li>Interface Segregation Principle - Many client-specific interfaces are better than one general-purpose interface</li>
  <li>Dependency Inversion Principle - High level modules should not depend on low level modules. Both should depend on abstractions</li>
</ul>

<p>In this article we will focus on the Interface Segregation Principle.</p>

<h2 id="what-does-it-mean">What does it mean?</h2>

<p>The summary of the principle is as follows:</p>

<blockquote>
  <p>Many client-specific interfaces are better than one general-purpose interface</p>
</blockquote>

<p>In Swift, we use <a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html">Protocols</a> rather than interfaces in languages such as Java so from here on out we will refer to interfaces as Protocols.</p>

<p>Now the purpose of this rule is quite straight forward in comparison to some of the other rules in the SOLID principles. What it means is its better to create smaller Protocols than to create one large one with lots of methods defined.</p>

<h2 id="whats-the-problem">What’s the problem</h2>

<p>So why does having one large protocol cause a problem? Let’s examine one of the classic Cocoa Touch protocols to see why this is an issue.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">UITableViewDataSource</span> <span class="p">:</span> <span class="kt">NSObjectProtocol</span> <span class="p">{</span>

    <span class="c1">// 1</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span>

    <span class="c1">// 2</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">numberOfSections</span><span class="p">(</span><span class="k">in</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">titleForHeaderInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> 
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">titleForFooterInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">canEditRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">canMoveRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">sectionIndexTitles</span><span class="p">(</span><span class="k">for</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]?</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">sectionForSectionIndexTitle</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">at</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">commit</span> <span class="nv">editingStyle</span><span class="p">:</span> <span class="kt">UITableViewCell</span><span class="o">.</span><span class="kt">EditingStyle</span><span class="p">,</span> <span class="n">forRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span>
    <span class="kd">optional</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">moveRowAt</span> <span class="nv">sourceIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">,</span> <span class="n">to</span> <span class="nv">destinationIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>I am sure many of you have implemented this protocol at some point in your past ;) I have modified the source slightly to make it easier to read and get the point across So why are we looking at this?</p>

<ol>
  <li>Only 2 methods you have to implement on the first 2.</li>
  <li>The rest of the methods are optional and you can implement whichever ones you feel you want to use.</li>
</ol>

<p>Now this protocol has its roots in <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Introduction/Introduction.html">Objective C</a> helps it masks the problem somewhat. In Objective C as you can see in the code above its possible to mark certain functions as optional. This means you can implement them if you want to but don’t have to, this allows this protocol declaration to contain too many methods without causing problems for the implementing class.</p>

<p>In Swift, it is not possible to mark functions as optional, all functions need to be implemented. Let’s update the above protocol to be more Swifty and see what problems that might cause us.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="kt">MyUITableViewDataSource</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span>

    <span class="kd">func</span> <span class="nf">numberOfSections</span><span class="p">(</span><span class="k">in</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">titleForHeaderInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> 
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">titleForFooterInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">canEditRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">canMoveRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
    <span class="kd">func</span> <span class="nf">sectionIndexTitles</span><span class="p">(</span><span class="k">for</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]?</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">sectionForSectionIndexTitle</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">at</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">commit</span> <span class="nv">editingStyle</span><span class="p">:</span> <span class="kt">UITableViewCell</span><span class="o">.</span><span class="kt">EditingStyle</span><span class="p">,</span> <span class="n">forRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">moveRowAt</span> <span class="nv">sourceIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">,</span> <span class="n">to</span> <span class="nv">destinationIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>Now that we have converted our protocol to be more swifty, what problem will this cause when we attempt to make a class conform to this protocol? Let’s have a look at an example.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">MyTableViewDatasource</span><span class="p">:</span> <span class="kt">MyUITableViewDataSource</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">numberOfSections</span><span class="p">(</span><span class="k">in</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">titleForHeaderInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">titleForFooterInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">canEditRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">canMoveRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">sectionIndexTitles</span><span class="p">(</span><span class="k">for</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]?</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">sectionForSectionIndexTitle</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">at</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">commit</span> <span class="nv">editingStyle</span><span class="p">:</span> <span class="kt">UITableViewCell</span><span class="o">.</span><span class="kt">EditingStyle</span><span class="p">,</span> <span class="n">forRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">moveRowAt</span> <span class="nv">sourceIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">,</span> <span class="n">to</span> <span class="nv">destinationIndexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></figure>

<p>Our class above now has to implement every single protocol method. Even if we don’t intend to use it. In the objective c implementation of the protocol we have the option of implementing only the ones we need whereas now we must implement every single method. Imagine all the view controllers in the world that would be full of empty methods in order to conform to this protocol!</p>

<p>This protocol breaks the interface segregation principle.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="a-better-solution">A better solution</h2>

<p>To improve the solution we could break the one big interface down into smaller protocols. That way we could conform to only the protocols we were interested in implementing for our functionality. This may looks something like:</p>

<ol>
  <li>UITableViewDataSource - For the 2 compulsory methods we are familier with</li>
  <li>UITableViewSectionsDatasource - For methods relating to multi section methods</li>
  <li>UITableViewSectionTitles - For methods relating to headers and footers in sections</li>
  <li>UITableViewEditable - For methods relating to editing and moving cells</li>
</ol>

<p>This way we could conform to select methods we want, rather than one big interface where we may only want a small subset of the methods.</p>

<h2 id="a-good-example">A good example</h2>

<p>A good example of interface segregation in the iOS SDK is Codable. The definition of Codable is as below:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">typealias</span> <span class="kt">Codable</span> <span class="o">=</span> <span class="kt">Decodable</span> <span class="o">&amp;</span> <span class="kt">Encodable</span></code></pre></figure>

<p>Basically Codable is just the combination of 2 other protocols: Decodable and Encodable. This is a great example of how to do the interface segregation. If you are building say a JSON parse struct, you may wish to only conform to Decodable so you can decode the JSON. If in the future you wanted to serialize the struct for something like say data storage you can conform to Encoding later if needed.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="summary">Summary</h2>

<p>The interface segregation principle is the easiest of the principles to understand in my opinion. In basic terms it means don’t create a big protocol with lots of methods that aren’t always required to be implemented depending on the implementation requirements.</p>

<p>Instead, separate the protocol into smaller protocols with only the methods required for a single piece of functionality to work. Not only does this avoids having lots of redundant methods it also helps to facilitate the single responsibility principle by allowing functionality to be broken down into different classes. For example, you could have different classes to handle different activities rather than one big class with all functionality in.</p>


                
                    <p><a href="/architecture/solid-principles-in-swift-interface-segragation-principle.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SOLID Principles in Swift - Interface Segragation Principle&p[summary]=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&p[url]=https://pyartez.github.io/architecture/solid-principles-in-swift-interface-segragation-principle.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/architecture/solid-principles-in-swift-interface-segragation-principle.html&text=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&hashtags=swift,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2022-04-18T06:00:00+01:00" itemprop="datePublished">18 Apr, 2022</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/architecture/">architecture</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/architecture/solid-principles-in-swift-liskov-substitution-principle.html">SOLID Principles in Swift - Liskov Substitution Principle</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principles / guidelines, that when followed when developing a software system, make it more likely that the system will be easier to extend and maintain over time. Let’s take a look at the problems that they seek to solve:</p>

<ul>
  <li>Fragility: A change may break unexpected parts, it is very difficult to detect if you don’t have a good test coverage</li>
  <li>Immobility: A component is difficult to reuse in another project or in multiple places of the same project because it has too many coupled dependencies</li>
  <li>Rigidity: A change requires a lot of effort because it affects several parts of the project</li>
</ul>

<p>So what are the SOLID principles?</p>

<ul>
  <li>Single Responsibility Principle - A class should have only a single responsibility / have only one reason to change</li>
  <li>Open-Closed Principle - Software should be open for extension but closed for modification</li>
  <li>Liskov Substitution Principle - Objects in a program should be replaceable with instances of their sub types without altering the correctness of the program</li>
  <li>Interface Segregation Principle - Many client-specific interfaces are better than one general-purpose interface</li>
  <li>Dependency Inversion Principle - High level modules should not depend on low level modules. Both should depend on abstractions</li>
</ul>

<p>In this article we will focus on the Liskov Substitution Principle.</p>

<h2 id="what-does-it-mean">What does it mean?</h2>

<p>So the Liskov Substitution Principle states:</p>

<blockquote>
  <p>Derived classes must be substitutable for their base classes</p>
</blockquote>

<p>What exactly does this mean? In a basic sense it for example if you have a function that accepts a type of class which is a parent of other classes, any class that subclasses the parent class should be able to be passed in without it breaking the program.</p>

<p>See a summary of the main points of the principle below:</p>

<ol>
  <li>Contra variance of method parameter types in the sub type.</li>
  <li>Covariance of method return types in the sub type.</li>
  <li>New exceptions cannot be thrown by the methods in the sub type, except if they are sub types of exceptions thrown by the methods of the super type.</li>
  <li>Don’t implement stricter validation rules on input parameters than those implemented by the parent class.</li>
  <li>Apply at the least the same rules to all output parameters as applied by the parent class.</li>
</ol>

<p>Let’s take a look at what these different rules mean for subclasses.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="the-parent-class">The Parent Class</h2>

<p>First of all, let’s define our parent class or base class that contains some functionality. Let’s use a vehicle class as an example, this vehicle has a throttle which can be set at any value between 0 and 100.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">enum</span> <span class="kt">VehicleError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">outOfBounds</span>
<span class="p">}</span>

<span class="c1">// 2</span>
<span class="kd">class</span> <span class="kt">Vehicle</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">throttle</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1">// 3</span>
    <span class="kd">func</span> <span class="nf">setThrottle</span><span class="p">(</span><span class="nv">throttle</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="nf">guard</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">throttle</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">VehicleError</span><span class="o">.</span><span class="n">outOfBounds</span>
        <span class="p">}</span>
        <span class="k">self</span><span class="o">.</span><span class="n">throttle</span> <span class="o">=</span> <span class="n">throttle</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Let’s step through it:</p>

<ol>
  <li>First of all we define a custom error to throw if the throttle is not within bounds</li>
  <li>Here we define our vehicle class that has a throttle variable to store the value being set</li>
  <li>We have a function to set the throttle value, there is a guard statement to check whether the value being set is in the appropriate range. If it is not, we throw an error, if it is we set the value</li>
</ol>

<h2 id="validation-rules-on-input-parameters">Validation rules on input parameters</h2>

<p>Now let’s create a subclass that breaks the principle. We will make a lorry class that inherits from the super class but adds its own restrictions to the throttle function, only allowing the throttle to be set between 0 and 60 for example.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">Lorry</span><span class="p">:</span> <span class="kt">Vehicle</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setThrottle</span><span class="p">(</span><span class="nv">throttle</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="nf">guard</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">throttle</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">VehicleError</span><span class="o">.</span><span class="n">outOfBounds</span>
        <span class="p">}</span>
        
        <span class="k">try</span> <span class="k">super</span><span class="o">.</span><span class="nf">setThrottle</span><span class="p">(</span><span class="nv">throttle</span><span class="p">:</span> <span class="n">throttle</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So what is happening here? We have subclassed the Vehicle class and overriden the setThrottle method. Now what we have done here is we have added a guard statement to check if the throttle is between 0 and 60. We throw an error saying out of bounds if outside of that, if it is within bounds we call the super class method.</p>

<p>Why is this a problem? Well imagine we are building a system / class that interacts with the Vehicle class. Now based on the Vehicle class you would expect to be able to set the throttle to anything between 0 and a 100. However now, if someone chooses to pass a Lorry subclass to your system / class, you will not be able to set the throttle above 60. Depending on how this other class or system is built this may have unintended side effects as you can’t set the values that you are expecting without getting an error.</p>

<p>This example breaks the rule:</p>

<blockquote>
  <p>Don’t implement stricter validation rules on input parameters than those implemented by the parent class.</p>
</blockquote>

<h2 id="errors-in-the-liskov-principle">Errors in the liskov principle</h2>

<p>Let’s modify our example to see how we could break the principle by throwing different errors. Let’s modify the Lorry subclass:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">LorryError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">outOfBounds</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Lorry</span><span class="p">:</span> <span class="kt">Vehicle</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setThrottle</span><span class="p">(</span><span class="nv">throttle</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="nf">guard</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">throttle</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">LorryError</span><span class="o">.</span><span class="n">outOfBounds</span>
        <span class="p">}</span>
        
        <span class="k">try</span> <span class="k">super</span><span class="o">.</span><span class="nf">setThrottle</span><span class="p">(</span><span class="nv">throttle</span><span class="p">:</span> <span class="n">throttle</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So what is happening here:</p>

<ul>
  <li>We have added a new Error type called LorryError</li>
  <li>When we have our bounds exception we are throwing this new error type instead of the one provided by the super class</li>
</ul>

<p>Why does that cause a problem? To find out let’s take a look at the error handling code:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="k">let</span> <span class="nv">vehicle</span><span class="p">:</span> <span class="kt">Vehicle</span> <span class="o">=</span> <span class="kt">Vehicle</span><span class="p">()</span>

<span class="k">do</span> <span class="p">{</span>
	<span class="c1">// 2</span>
    <span class="k">try</span> <span class="n">vehicle</span><span class="o">.</span><span class="nf">setThrottle</span><span class="p">(</span><span class="nv">throttle</span><span class="p">:</span> <span class="mi">110</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kt">VehicleError</span><span class="o">.</span><span class="n">outOfBounds</span> <span class="p">{</span>
	<span class="c1">// 3</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"System shutdown"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
	<span class="c1">// 4</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Show generic error"</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>Let’s step through this code:</p>

<ol>
  <li>We are creating a Vehicle super class object.</li>
  <li>We are calling our function with a value considered out of bounds</li>
  <li>We catch the outOfBounds exception and print a system shutdown message</li>
  <li>We have a generic catch for other errors where we show a generic error message</li>
</ol>

<p>Now if we run this code we see the below message in the console as expected:</p>

<blockquote>
  <p>System shutdown</p>
</blockquote>

<p>So what happens if we replace our Lorry subclass with its new error and put it in place of the Vehicle super class? If we change line one to read:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">vehicle</span><span class="p">:</span> <span class="kt">Vehicle</span> <span class="o">=</span> <span class="kt">Lorry</span><span class="p">()</span></code></pre></figure>

<p>If we run the code above we will now see a different error:</p>

<blockquote>
  <p>Show generic error</p>
</blockquote>

<p>The error handling code is not aware of subclass specific errors so is no longer able to handle them accordingly. Imagine a mission critical system that needs to shut down if an out of bounds happens, in this case the error would be missed as it would require the error handling class to have knowledge of all possible sub types in order to handle all the errors appropriate. Defeating the point of using the super class and thus breaking the principle:</p>

<blockquote>
  <p>New exceptions cannot be thrown by the methods in the sub type, except if they are sub types of exceptions thrown by the methods of the super type.</p>
</blockquote>

<h2 id="contra-variance-and-covariance-of-parameters-and-return-types">Contra variance and Covariance of parameters and return types</h2>

<p>In the list of rules you may recall seeing two items talking about contra variance and covariance of parameters and return types. What does that mean exactly?</p>

<ol>
  <li>Contra variance of method parameter types in the sub type.</li>
  <li>Covariance of method return types in the sub type.</li>
</ol>

<h3 id="contra-variance-of-method-parameter-types-in-the-sub-type">Contra variance of method parameter types in the sub type</h3>

<p>Contra variance means that we can use change the type of method parameter to a super class of the type but not a subclass. This rules works basically in combination with the rule below:</p>

<blockquote>
  <p>Don’t implement stricter validation rules on input parameters than those implemented by the parent class.</p>
</blockquote>

<p>What it means is, we can use a super class of a parameter, thus ‘weakening’ the restrictions of the method, but not a subclass of that type which would tighten the restrictions of the method.</p>

<h3 id="covariance-of-method-return-types-in-the-sub-type">Covariance of method return types in the sub type</h3>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Covariance means that the type being used can be a sub type of the class provided by the super class function return type. Similarly, this works in the same way as the 5th rule:</p>

<blockquote>
  <p>Apply at the least the same rules to all output parameters as applied by the parent class.</p>
</blockquote>

<p>Now both of these rules aren’t possible to be broken as part of Swift. It’s not possible to overload functions providing alternative type specifications, at least while still referring to the super class type. We can override methods and provide different parameter types and return types but this requires the calling class to know the type of the subclass. When referring to the super class, the super class implementation is always called regardless of subclass functions with different params.</p>



                
                    <p><a href="/architecture/solid-principles-in-swift-liskov-substitution-principle.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SOLID Principles in Swift - Liskov Substitution Principle&p[summary]=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&p[url]=https://pyartez.github.io/architecture/solid-principles-in-swift-liskov-substitution-principle.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/architecture/solid-principles-in-swift-liskov-substitution-principle.html&text=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&hashtags=swift,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2021-05-07T06:00:00+01:00" itemprop="datePublished">7 May, 2021</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/architecture/">architecture</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/architecture/solid-principles-in-swift-open-closed-principle.html">SOLID Principles in Swift - Open / Closed Principle</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principles / guidelines, that when followed when developing a software system, make it more likely that the system will be easier to extend and maintain over time. Let’s take a look at the problems that they seek to solve:</p>

<ul>
  <li>Fragility: A change may break unexpected parts, it is very difficult to detect if you don’t have a good test coverage</li>
  <li>Immobility: A component is difficult to reuse in another project or in multiple places of the same project because it has too many coupled dependencies</li>
  <li>Rigidity: A change requires a lot of effort because it affects several parts of the project</li>
</ul>

<p>So what are the SOLID principles?</p>

<ul>
  <li>Single Responsibility Principle - A class should have only a single responsibility / have only one reason to change</li>
  <li>Open-Closed Principle - Software should be open for extension but closed for modification</li>
  <li>Liskov Substitution Principle - Objects in a program should be replaceable with instances of their sub types without altering the correctness of the program</li>
  <li>Interface Segregation Principle - Many client-specific interfaces are better than one general-purpose interface</li>
  <li>Dependency Inversion Principle - High level modules should not depend on low level modules. Both should depend on abstractions</li>
</ul>

<p>In this article we will focus on the Open-Closed Principle.</p>

<h2 id="what-does-it-mean">What does it mean?</h2>

<p>So the open-closed principle states:</p>

<blockquote>
  <p>Software should be open for extension but closed for modification</p>
</blockquote>

<p>What exactly does this mean? I think out of all the principles this is the hardest to understand. Mostly due to the fact the explanation leaves far too much open to interpretation. A simple Google search will offer up several examples of how this principle works. In this article I will present my take on the principle and how to build software that will comply with it.</p>

<p>Let’s focus on a type that by design, violates the open closed principle.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="enums">Enums</h2>

<p><a href="https://docs.swift.org/swift-book/LanguageGuide/Enumerations.html">Enums</a> are a very powerful tool in Swift. They are first class types and such can have associated values and conform to protocols for example. However when used at the boundary of a particular system or module they can present a particular problem.</p>

<p>Let’s imagine an analytics system where we can log events. This is a design pattern I’ve seen in many places:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">enum</span> <span class="kt">AnalyticsEvent</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">newsList</span>
    <span class="k">case</span> <span class="nf">newsDetail</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 2</span>
<span class="kd">class</span> <span class="kt">AnalyticsController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">AnalyticsEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">title</span>
        <span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">params</span>
        
        <span class="c1">// Send data to analytics network</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 3</span>
<span class="kd">extension</span> <span class="kt">AnalyticsEvent</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">newsList</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"News List"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">newsDetail</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"News detail"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">params</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">newsList</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[:]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">newsDetail</span><span class="p">(</span><span class="k">let</span> <span class="nv">id</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Let’s look at what we have here.</p>

<ol>
  <li>The first thing that is defined is an enum that houses all the different analytics events that are available. Some with associated values.</li>
  <li>Next we have our analytics controller, this takes an event as a parameter, takes information from the event and would then send that on to our analytics system.</li>
  <li>Here we have extended the AnalyticsEvent enum to add 2 variables, one for title and one for params that contain a switch for each of our events.</li>
</ol>

<p>On the surface or at first look this might appear an ok solution. We have hidden our implementation of the analytics network inside our AnalyticsController and setup a defined set of events that we can support.</p>

<h3 id="the-problem">The Problem</h3>

<p>Now lets look at the problems that this approach causes.</p>

<ul>
  <li>What happens if we need to add new events to our analytics system?</li>
  <li>What if our analytics system was part of a separate package or module?</li>
  <li>What happens when we have a lot of events?</li>
</ul>

<p>So first of all, every time we need to add / update or remove any of the events in our analytics system we need to modify the enum. We can’t just implement new events and have them be compatible with the system. Also if the number of events becomes very large then the code will grow large in size. Making it hard to read, maintain and a bit of a mess. Also the enum now has multiple responsibilities, as it covers many events breaking the <a href="/architecture/solid-principles-in-swift-single-responsibility-principle.html">single responsibility principle</a>.</p>

<p>The second issue which is probably the more important one, is let’s say we are breaking our app down in to separate packages. This Analytics Controller and Event would be in a separate package, what if we wanted to re-use it across different projects? Both of these scenarios become very difficult because we are using an enum that would need to be updated to accommodate events for different apps. The package would need constantly updating as new events were added.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6959344114005358" data-ad-slot="4928663865"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h3 id="the-solution">The Solution</h3>

<p>So we have identified some issues with the above implementation, how can we change it to make solve these issues we have identified? Look at the new example:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">struct</span> <span class="kt">NewsListEvent</span><span class="p">:</span> <span class="kt">AnalyticsEvent</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"News List"</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">params</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[:]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">NewsDetailEvent</span><span class="p">:</span> <span class="kt">AnalyticsEvent</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"News detail"</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">params</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 2</span>
<span class="kd">protocol</span> <span class="kt">AnalyticsEvent</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">params</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">AnalyticsController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="n">_</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">AnalyticsEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">title</span>
        <span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">params</span>
        
        <span class="c1">// Send data to analytics network</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Let’s look at how we have changed the example:</p>

<ol>
  <li>
    <p>First of all we have now removed the enum. Using an enum as a huge list of possible options is considered a code smell. Especially when it involves something that may change often. If you have a finite number of states that is unlikely to change, that is more suited to an enum than a list of analytics events. We have refactored those enum cases into 2 separate classes now.</p>
  </li>
  <li>
    <p>We have switched the enum for a protocol that exposes the necessary items required by our analytics controller (we could have potentially done this in the previous example however we would still have the enum).</p>
  </li>
</ol>

<p>So what advantages does this have over the previous implementation?</p>

<ul>
  <li>With the events now being in separate classes we are now following the <a href="/architecture/solid-principles-in-swift-single-responsibility-principle.html">single responsibility principle</a>, each event has its own class that can be updated whenever they need to be.</li>
  <li>Now that we are using a protocol and not an enum, we are now able to add new events to our app without ever having to touch the analytics system. Simply create a new class and make it conform to AnalyticsEvent, and we can use it with the analytics controller.</li>
  <li>Further to that we could have our analytics system in a separate reusable package, then our client apps could define their own set of events to use with the system.</li>
</ul>

<p>Our analytics code is now open for extension, but does not need to be modified to support new events. Unlike our enum example.</p>


                
                    <p><a href="/architecture/solid-principles-in-swift-open-closed-principle.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SOLID Principles in Swift - Open / Closed Principle&p[summary]=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&p[url]=https://pyartez.github.io/architecture/solid-principles-in-swift-open-closed-principle.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/architecture/solid-principles-in-swift-open-closed-principle.html&text=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&hashtags=swift,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2021-04-10T06:00:00+01:00" itemprop="datePublished">10 Apr, 2021</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/architecture/">architecture</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/architecture/solid-principles-in-swift-single-responsibility-principle.html">SOLID Principles in Swift - Single Responsibility Principle</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principles / guidelines, that when followed when developing a software system, make it more likely that the system will be easier to extend and maintain over time. Let’s take a look at the problems that they seek to solve:</p>

<ul>
  <li>Fragility: A change may break unexpected parts, it is very difficult to detect if you don’t have a good test coverage</li>
  <li>Immobility: A component is difficult to reuse in another project or in multiple places of the same project because it has too many coupled dependencies</li>
  <li>Rigidity: A change requires a lot of effort because it affects several parts of the project</li>
</ul>

<p>So what are the SOLID principles?</p>

<ul>
  <li>Single Responsibility Principle - A class should have only a single responsibility / have only one reason to change</li>
  <li>Open-Closed Principle - Software should be open for extension but closed for modification</li>
  <li>Liskov Substitution Principle - Objects in a program should be replaceable with instances of their sub types without altering the correctness of the program</li>
  <li>Interface Segregation Principle - Many client-specific interfaces are better than one general-purpose interface</li>
  <li>Dependency Inversion Principle - High level modules should not depend on low level modules. Both should depend on abstractions</li>
</ul>

<p>In this article we will focus on the Single Responsibility Principle.</p>

<h2 id="problem">Problem</h2>

<p>The first principle in the list is the Single Responsibility Principle. This principle is defined as follows:</p>

<blockquote>
  <p>A class should have only one reason to change</p>
</blockquote>

<p>This means a class should be responsible for only one task, not multiple. Let’s take a look at an example and how we can refactor it using the principle.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">SomeNews</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">NewsDatasource</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">getNews</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">SomeNews</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 1. Create request</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"SomeNews/URL"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        
        <span class="c1">// 2. Fetching data</span>
        <span class="k">let</span> <span class="nv">dataTask</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            
            <span class="c1">// 3. Parsing data</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                  <span class="k">let</span> <span class="nv">news</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">([</span><span class="kt">SomeNews</span><span class="p">]</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">completion</span><span class="p">([])</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="nf">completion</span><span class="p">(</span><span class="n">news</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="n">dataTask</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This looks like a fairly simple news datasource / service that is fetching some news items from the web. However if we take a closer look we will see it’s responsible for more than one task.</p>

<ol>
  <li>Creating the URLRequest that is used to fetch the news articles</li>
  <li>Fetching the data using a URLSession</li>
  <li>Parsing the data</li>
</ol>

<p>Already that is 3 different responsibilities this class has. They may seem fairly straight forward in this example but imagine how this could get out of hand quickly in a larger codebase. Let’s cover some of the scenarios.</p>

<ul>
  <li>Is this example the news request is simple. However what if the request was more complex, what if we needed to add headers etc to that request? All that code would be in this class.</li>
  <li>What if we wanted to change the request used to fetch the news? We would have to make a code change here. Or what if we could fetch news from more than one API? How would we do that in the current structure?</li>
  <li>Once the request has been made we are using a JSONDecoder to decode the response. What if the response comes back in a different format? What if we wanted to use a different decodable for the response?</li>
  <li>What if the news request can be used in multiple places?</li>
</ul>

<p>As we can see from the above list, there are several scenarios that would require a code change of this class. If we recall what the single responsibility stands for:</p>

<blockquote>
  <p>A class should have only one reason to change</p>
</blockquote>

<p>There is also a side effect of this which isn’t as obvious, that is testability. Let’s look at some examples:</p>

<ul>
  <li>How would we test changes the URLRequest? If did indeed change the URLRequest or it was being generated differently, how would we test that?</li>
  <li>How do we test how our class handles responses from the server? What happens if we get an error for example?</li>
  <li>How do we test our decoding code? How can we be sure that it is going to handle incorrect data correctly? How does our news datasource handle decoding errors?</li>
</ul>

<p>If we look at the code in the example we can see that in would be impossible to write unit tests covering any of the above scenarios. Let’s have a look at how we can break this class down into single components, allowing us to make changes only in one place and at the same time improving testability.</p>

<h2 id="breaking-it-down">Breaking it down</h2>

<h3 id="url-builder">URL Builder</h3>

<p>Let’s start by breaking this class down into separate classes, each with one responsibility. First of all let’s take out the building of the URLRequest and put it in another class.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">NewsURLBuilder</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">hostName</span><span class="p">:</span> <span class="kt">String</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">hostName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">hostName</span> <span class="o">=</span> <span class="n">hostName</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">getNews</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">URLRequest</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">hostName</span><span class="se">)</span><span class="s">SomeNews/URL"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">request</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Great, now we have a class that’s only responsibility is to build and return a URLRequest. In a more complex system this class might need ids, user tokens etc in order to configure the request. In the scenario where we need to change how news is retrieved we only need to modify this one class in order to make that change. We can also change the hostname based on the environment such as dev, test and prod.</p>

<p>The other benefit of doing this is we can now write unit tests to make sure that the URLRequest is being built correctly. Let’s do a small example now:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">URLBuilderTests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">testURLBuilder</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">builder</span> <span class="o">=</span> <span class="kt">NewsURLBuilder</span><span class="p">(</span><span class="nv">hostName</span><span class="p">:</span> <span class="s">"http://mytest.com/"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="nf">getNews</span><span class="p">()</span>
        
        <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">?</span><span class="o">.</span><span class="n">absoluteString</span><span class="p">,</span> <span class="s">"http://mytest.com/SomeNews/URL"</span><span class="p">,</span> <span class="s">"Request URL string is incorrect"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p>Our URL builder isn’t particularly complex so doesn’t need many tests. But at least here with it being in a separate component we can test the construction and make sure it’s being created correctly. We could expand this test to test other elements of the request if needed, or if we needed different parameters to build the request.</p>

<h3 id="parser">Parser</h3>

<p>Next lets take the parser and put that into it’s own class.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">NewsParser</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">decoder</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">SomeNews</span><span class="p">]</span> <span class="p">{</span>
        <span class="nf">return</span> <span class="p">(</span><span class="k">try</span><span class="p">?</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">([</span><span class="kt">SomeNews</span><span class="p">]</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">data</span><span class="p">))</span> <span class="p">??</span> <span class="p">[]</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Here we can see we have taken our decoding code and put it into a separate class. This class has one reason to change, it only needs to be changed if the parsing needs to be changed! Also like our URL builder class we can now test the decoding to make sure we get the results we are expecting:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">NewsParserTests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">testCorrectData</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">correctJSON</span> <span class="o">=</span> <span class="s">"""
        [
          {
            "</span><span class="n">id</span><span class="s">": 1,
            "</span><span class="n">title</span><span class="s">": "</span><span class="kt">Test</span> <span class="kt">Article</span> <span class="mi">1</span><span class="s">"
          },
          {
            "</span><span class="n">id</span><span class="s">": 2,
            "</span><span class="n">title</span><span class="s">": "</span><span class="kt">Test</span> <span class="kt">Article</span> <span class="mi">2</span><span class="s">"
          }
        ]
        """</span>
        
        <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">correctJSON</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
        
        <span class="k">let</span> <span class="nv">parser</span> <span class="o">=</span> <span class="kt">NewsParser</span><span class="p">(</span><span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
        <span class="k">let</span> <span class="nv">news</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
        <span class="kt">XCTAssertFalse</span><span class="p">(</span><span class="n">news</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">)</span>
        <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">news</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">news</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">"Test Article 1"</span><span class="p">)</span>
    <span class="p">}</span>

    
    <span class="kd">func</span> <span class="nf">testInCorrectData</span><span class="p">()</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">incorrectJSON</span> <span class="o">=</span> <span class="s">"""
        [
          {
            "</span><span class="n">id</span><span class="s">": 1,
            "</span><span class="n">title</span><span class="s">": "</span><span class="kt">Test</span> <span class="kt">Article</span> <span class="mi">1</span><span class="s">"
          },
          {
            "</span><span class="n">id</span><span class="s">": 2,
        ]
        """</span>
        
        <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">incorrectJSON</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>
        
        <span class="k">let</span> <span class="nv">parser</span> <span class="o">=</span> <span class="kt">NewsParser</span><span class="p">(</span><span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
        <span class="k">let</span> <span class="nv">news</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
        <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">news</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So what have we done here. We have created a couple of unit tests for our parser.</p>

<ul>
  <li>The first one supplies the parser with some correct JSON data and checks that the news objects we receive are correct and have the right data.</li>
  <li>The second test sends some incorrect data to the parser and tests that we receive an empty array as expected</li>
</ul>

<p><strong><em>I’m aware that we aren’t handling errors in this example, this has been done to try and keep things as simple as possible</em></strong></p>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Now that we have separated out these components into separate pieces, lets see how our datasource looks now.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">NewsDatasource</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">requestBuilder</span><span class="p">:</span> <span class="kt">NewsURLBuilder</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">parser</span><span class="p">:</span> <span class="kt">NewsParser</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">requestBuilder</span><span class="p">:</span> <span class="kt">NewsURLBuilder</span><span class="p">,</span> <span class="nv">parser</span><span class="p">:</span> <span class="kt">NewsParser</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">requestBuilder</span> <span class="o">=</span> <span class="n">requestBuilder</span>
        <span class="k">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">getNews</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">SomeNews</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 1. Create request</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="n">requestBuilder</span><span class="o">.</span><span class="nf">getNews</span><span class="p">()</span>
        
        <span class="c1">// 2. Fetching data</span>
        <span class="k">let</span> <span class="nv">dataTask</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            
            <span class="c1">// 3. Parsing data</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">self</span> <span class="o">=</span> <span class="k">self</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">completion</span><span class="p">([])</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="nf">completion</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">))</span>
        <span class="p">}</span>
        
        <span class="n">dataTask</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Now if we look here we can see that we have swapped out the code for building the request and parsing the data for our separate classes. Now our example is following the single responsibility principle. We have 3 components now:</p>

<ol>
  <li>A component to build our request</li>
  <li>A component to execute the request</li>
  <li>A component to parse the data we get back from the request</li>
</ol>

<p>So what have we gained:</p>

<ul>
  <li>We now have test coverage of our components (we could update the NewsDatasource to have tests too but that is a bit more advanced and out of scope of this article)</li>
  <li>We have the ability to re-use these components in other parts of the app or in other apps if we need to</li>
  <li>If we need to make changes, each component is only responsibility for one thing, so we can update and test each change in turn. Rather than making multiple changes in one place and not be able to test them!</li>
</ul>

<p>Feel free to <a href="https://github.com/pyartez/single-responsibility">download the sample</a> and play around with the tests yourself!</p>


                
                    <p><a href="/architecture/solid-principles-in-swift-single-responsibility-principle.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SOLID Principles in Swift - Single Responsibility Principle&p[summary]=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&p[url]=https://pyartez.github.io/architecture/solid-principles-in-swift-single-responsibility-principle.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/architecture/solid-principles-in-swift-single-responsibility-principle.html&text=Background

In this series of posts we are going to be covering the SOLID principles of software development. These are a set of principl...&hashtags=swift,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2021-02-09T08:00:00+00:00" itemprop="datePublished">9 Feb, 2021</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/swiftUI/">swiftUI</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/swiftui/using-protocols-observableobject-published-property-wrappers-swiftui.html">Using protocols, ObservableObject and @Published property wrappers in SwiftUI</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>As I’m sure any iOS developer now knows, the future of iOS app development is <a href="https://developer.apple.com/xcode/swiftui/">SwiftUI</a>. Apple’s new UI development language is now on it’s 2nd major release. While my own personal feeling is that the framework is not quite ready for prime time (much like when Swift first arrived. It’s missing some fairly key features) and we are perhaps a version or 2 away from it realistically being an option for being used to build a complete app. There is no denying that it is the future and when it works well, it makes building UI a lot easier.</p>

<p>As SwiftUI is the future, I’ve been investigating how teams might migrate their existing architectures across to the new technology. There a number of challenges presented by migrating to SwiftUI we will discuss below. As the title suggests we will be exploring how to use a presenter to control a SwiftUI view. It doesn’t matter which architecture you are using as such, whether it’s VIPER, MVVVM, VIP, MVP etc. As long as the logic and state of the view has been abstracted away from the view itself so it can be properly unit tested.</p>

<h2 id="example">Example</h2>

<h3 id="list-item-view">List Item View</h3>

<p>Let’s start by creating an example in SwiftUI. We will create a simple list view to display some news for example. Let’s create a simple list view first of all:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">struct</span> <span class="kt">ListItemViewModel</span><span class="p">:</span> <span class="kt">Identifiable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// 2</span>
<span class="kd">struct</span> <span class="kt">ListItemView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">viewModel</span><span class="p">:</span> <span class="kt">ListItemViewModel</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">HStack</span><span class="p">()</span> <span class="p">{</span>
            <span class="kt">Image</span><span class="p">(</span><span class="n">viewModel</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
            <span class="kt">VStack</span><span class="p">(</span><span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">viewModel</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
                <span class="n">viewModel</span><span class="o">.</span><span class="n">subTitle</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">subheadline</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 3</span>
<span class="kd">struct</span> <span class="kt">ListItemView_Previews</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ListItemView</span><span class="p">(</span>
            <span class="nv">viewModel</span><span class="p">:</span> <span class="kt">ListItemViewModel</span><span class="p">(</span>
                <span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nv">title</span><span class="p">:</span> <span class="s">"Test Title"</span><span class="p">,</span>
                <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"Test Subtitle"</span><span class="p">,</span>
                <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This is quite a straight forward view, but let’s step through it.</p>

<ol>
  <li>First of all we define our model for the view. We have an id so that we can conform to <a href="https://developer.apple.com/documentation/swift/identifiable">Identifiable</a>. This allows SwiftUI to uniquely identify each model in the view and helps with performing things like animation and reordering. We also have a title, optional subTitle and an image string. Hopefully nothing here is too scary.</li>
  <li>Now we define the view inself. Views in SwiftUI are simple structs that conform to the View protocol, rather than subclasses of UIView like they used to be in UIKit. Its a simple Hstack with an image view then 2 labels stacked on top of each other. See the screen grab below.</li>
  <li>Finally we have the preview code to inject an example model to use in the preview.</li>
</ol>

<p><img src="/assets/images/swiftui-listview.png" alt="SwiftUI ListItemView" title="SwiftUI ListItemView" /></p>

<h3 id="list-view">List View</h3>

<p>Now that we have the items in our list, lets create a simple list view that displays those items.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span>
 
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">listItems</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">ListItemView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 2</span>
<span class="kd">struct</span> <span class="kt">ContentView_Previews</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test2"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub1"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test3"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub2"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test4"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub3"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test5"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub4"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">)]</span>
        
        <span class="kt">ContentView</span><span class="p">(</span><span class="nv">listItems</span><span class="p">:</span> <span class="n">items</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ok so what do we have here:</p>

<ol>
  <li>A simple ContentView who has an array of list item view models and a body. The body lists out the content of our list using the ListItemView we created earlier. Simple</li>
  <li>Here we have some test data to show that our list is working. If we preview this view we will see something like this:</li>
</ol>

<p><img src="/assets/images/swiftui-fulllistview.png" alt="SwiftUI ListView" title="SwiftUI ListView" /></p>

<p>That’s wonderful, however it is not particularly dynamic. This is where a presenter or view model would come in. If we look at the description of <a href="https://en.wikipedia.org/wiki/Model–view–presenter">MVP</a> or <a href="https://en.wikipedia.org/wiki/Model–view–viewmodel">MVVM</a> we will see they have a similar role:</p>

<blockquote>
  <p>The presenter acts upon the model and the view. It retrieves data from repositories (the model), and formats it for display in the view.</p>
</blockquote>

<p>There are further abstractions layers (such as interactors and use cases). However we are less concerned with them in this discussion and more on the relationship between the view and the presenter who is holding the state and logic of the view.</p>

<h3 id="abstracting-the-state">Abstracting the state</h3>

<p>So at the moment we have a pretty stateless SwiftUI view that simply displays a hardcoded list. Now let’s attempt to abstract the list items away into another object that is injected into the view. This object would be responsible for fetching our items and loading them for the view.</p>

<p>This is where an <a href="https://developer.apple.com/documentation/combine/observableobject">ObservableObject</a> comes in.</p>

<blockquote>
  <p>When your type conforms to ObservableObject, you are creating a new source of truth and teaching SwiftUI how to react to changes. In other words, you are defining the data that a view needs to render its UI and perform its logic. SwiftUI uses this dependency to automatically keep your view consistent and show the correct representation of your data. We like to think of ObservableObject as your data dependency surface. This is the part of your model that exposes data to your view, but it’s not necessarily the full model.</p>
</blockquote>

<p>So lets update our example to move our list of items into a separate class that conforms to this protocol.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">final</span> <span class="kd">class</span> <span class="kt">ListPresenter</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">}</span>


<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">presenter</span><span class="p">:</span> <span class="kt">ListPresenter</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">presenter</span><span class="p">:</span> <span class="kt">ListPresenter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
    <span class="p">}</span>
 
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">presenter</span><span class="o">.</span><span class="n">listItems</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">ListItemView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>The <a href="https://developer.apple.com/documentation/combine/published">@Published</a> property wrapper here works with the ObservableObject to notify SwiftUI whenever the value changes in order to trigger an update.</p>

<p>We also see the <a href="https://developer.apple.com/documentation/swiftui/observedobject">@ObservedObject</a> property wrapper. This causes this view to subscribe to the ObservableObject that’s assigned to it, and invalidates the view any time the object updates.</p>

<p>This is great and allows us to inject an object from outside of the view who can manage the fetching and supplying to the view, whenever the listItems var updates, the view will automatically update!</p>

<h3 id="de-coupling-dependencies">De-coupling dependencies</h3>

<p>Now there is one problem here, can you see it? This view has a dependency between the view itself and the presenter class. Now if you are following the SOLID principles for example, and like to separate dependencies between your classes and layers we will need to remove the dependency between the view and presenter.</p>

<p>To do this lets change the ListPresenter class to be a protocol instead:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">final</span> <span class="kd">class</span> <span class="kt">ListPresenterImp</span><span class="p">:</span> <span class="kt">ListPresenter</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ListPresenter</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">presenter</span><span class="p">:</span> <span class="kt">ListPresenter</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">presenter</span><span class="p">:</span> <span class="kt">ListPresenter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
    <span class="p">}</span>
 
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">presenter</span><span class="o">.</span><span class="n">listItems</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">ListItemView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This looks like it should be a straight forward change… Wrong! You will now start seeing errors galore. The primary cause coming from the decleration of our new protocol:</p>

<blockquote>
  <p>Property ‘listItems’ declared inside a protocol cannot have a wrapper</p>
</blockquote>

<p>The problem here being exactly as the error states. We cannot use property wrappers inside protocols! That is going to cause a bit of a problem as we now can’t make use of the nice integration with SwiftUI via @Published properties, or so it seems…</p>

<p>Let’s take a step back for a moment, what exactly does the @Published property wrapper actually do? The @Published property wrapper essentially provides a publisher that the SwiftUI system can subscribe to in order to listen to updates to the value. This is in fact an implementation detail. One of the key points of protocol oriented programming is to abstract the implementation of functions are variables away from the dependency so that it is unaware of the inner workings. By trying to apply a property wrapper to the protocol we are trying to enforce how that variable should implemented under the hood. When infact should the implementing class of our protocol wish to, they could create their own custom implementation of the wrapper.</p>

<h3 id="fixing-the-errors">Fixing the errors</h3>

<p>Ok so let’s start by removing the @Published property wrapper from our protocol:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">final</span> <span class="kd">class</span> <span class="kt">ListPresenterImp</span><span class="p">:</span> <span class="kt">ListPresenter</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ListPresenter</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">presenter</span><span class="p">:</span> <span class="kt">ListPresenter</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">presenter</span><span class="p">:</span> <span class="kt">ListPresenter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
    <span class="p">}</span>
 
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">presenter</span><span class="o">.</span><span class="n">listItems</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">ListItemView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Great! However there are now a bunch of different errors occuring… The key one that we need to pay attention to is this one:</p>

<blockquote>
  <p>Protocol ‘ListPresenter’ can only be used as a generic constraint because it has Self or associated type requirements</p>
</blockquote>

<p>Right, so we have solved the riddle of @Published but this has now surfaced another problem. In order for our ListPresenter protocol to be compatible with the ObervedObject property wrapper in the view, it must extend ObservableObject. Now the problem here is that the ObservableObject uses an associatedtype. Which means if we wish to use it or hold a reference to it we must do type erasure (for more info read my <a href="/type-erasure/what-is-type-erasure">previous post on type erasure</a>) or use a generic constraint.</p>

<p>The simplest solution is for us to use a generic constraint on the view. View the code below:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">final</span> <span class="kd">class</span> <span class="kt">ListPresenterImp</span><span class="p">:</span> <span class="kt">ListPresenter</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ListPresenter</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="k">where</span> <span class="kt">T</span><span class="p">:</span> <span class="kt">ListPresenter</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">presenter</span><span class="p">:</span> <span class="kt">T</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">presenter</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
    <span class="p">}</span>
 
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">presenter</span><span class="o">.</span><span class="n">listItems</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">ListItemView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>So what has changed here. You will now notice that we have added a generic type T to our view. We have also added a generic constraint when implementing the View protocol which signals that the init and body implementations here are only when type T is a ListPresenter. Now in this instance that works fine as we only intend to use this view with our ListPresenter class. This removes the errors and the code now compiles. Let’s update the code and run a little test to make sure we are still getting all the reactive goodness of SwiftUI.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">final</span> <span class="kd">class</span> <span class="kt">ListPresenterImp</span><span class="p">:</span> <span class="kt">ListPresenter</span> <span class="p">{</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">Timer</span><span class="o">.</span><span class="nf">scheduledTimer</span><span class="p">(</span><span class="nv">withTimeInterval</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="nv">repeats</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                        <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test2"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub1"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">)]</span>
            
            <span class="k">self</span><span class="o">.</span><span class="n">listItems</span> <span class="o">=</span> <span class="n">items</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">ListPresenter</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">listItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">]</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="k">where</span> <span class="kt">T</span><span class="p">:</span> <span class="kt">ListPresenter</span> <span class="p">{</span>
    <span class="kd">@ObservedObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">presenter</span><span class="p">:</span> <span class="kt">T</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">presenter</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">presenter</span> <span class="o">=</span> <span class="n">presenter</span>
    <span class="p">}</span>
 
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">List</span><span class="p">(</span><span class="n">presenter</span><span class="o">.</span><span class="n">listItems</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
            <span class="kt">ListItemView</span><span class="p">(</span><span class="nv">viewModel</span><span class="p">:</span> <span class="n">item</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>We have updated our list presenter implementation class to update our list items after 5 seconds. Nice and easy. If we initialise our view with a presenter with 5 items as below, then after 5 seconds our list should reduce to the 2 items as set in the timer.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">items</span> <span class="o">=</span> <span class="p">[</span><span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test2"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub1"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test3"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub2"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test4"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub3"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">),</span>
                    <span class="kt">ListItemViewModel</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="s">"test5"</span><span class="p">,</span> <span class="nv">subTitle</span><span class="p">:</span> <span class="s">"test sub4"</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="s">"first"</span><span class="p">)]</span>
        
<span class="k">let</span> <span class="nv">presenter</span> <span class="o">=</span> <span class="kt">ListPresenterImp</span><span class="p">()</span>
<span class="n">presenter</span><span class="o">.</span><span class="n">listItems</span> <span class="o">=</span> <span class="n">items</span>
<span class="k">let</span> <span class="nv">contentView</span> <span class="o">=</span> <span class="kt">ContentView</span><span class="p">(</span><span class="nv">presenter</span><span class="p">:</span> <span class="n">presenter</span><span class="p">)</span></code></pre></figure>

<p>Now let’s run this as part of an app and see what happens:</p>

<p><img src="/assets/images/Demo.mov" alt="Presenter Demo" title="Presenter demo" /></p>

<p>So as you can see, after 5 seconds the list of items is reduced after 5 seconds to 2 items, proving that our implementation works and we are still able to hook into the nice secret sauce that combine and swiftUI expose to us to allow us to update our views. I’ve seen some rather crazy implementations and workarounds on Stack Overflow. Hopefully this implementation is a little nicer!</p>

<p>Download the <a href="https://github.com/pyartez/swiftui-presenter">sample project</a> to run it for yourself (Xcode 12.4)</p>


                
                    <p><a href="/swiftui/using-protocols-observableobject-published-property-wrappers-swiftui.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Using protocols, ObservableObject and @Published property wrappers in SwiftUI&p[summary]=Background

As I’m sure any iOS developer now knows, the future of iOS app development is SwiftUI. Apple’s new UI development language is...&p[url]=https://pyartez.github.io/swiftui/using-protocols-observableobject-published-property-wrappers-swiftui.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/swiftui/using-protocols-observableobject-published-property-wrappers-swiftui.html&text=Background

As I’m sure any iOS developer now knows, the future of iOS app development is SwiftUI. Apple’s new UI development language is...&hashtags=swift,combine,swiftui,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/combine">combine</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/swiftui">swiftui</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2020-07-19T08:00:00+01:00" itemprop="datePublished">19 Jul, 2020</time></li>
                    
                    <li class="cats">
                        
                            <a href="/categories/architecture/">architecture</a>
                        
                    </li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://pyartez.github.io/architecture/repository-pattern-in-swift-and-combine.html">Repository Pattern in Swift</a></h2>
            </header>

            <div class="post-content">
                <h2 id="background">Background</h2>

<p>All apps developed require data of some description. This data is stored somewhere, could be on the device itself, in a remote database/service or a combination. Let’s take a look at the most common sources of data:</p>

<ul>
  <li><a href="https://www.w3schools.com/whatis/whatis_json.asp">JSON</a> web services</li>
  <li><a href="https://developer.apple.com/documentation/foundation/userdefaults">UserDefaults</a></li>
  <li><a href="https://developer.apple.com/documentation/coredata">Core Data</a></li>
  <li><a href="https://realm.io/docs/swift/latest/">Realm</a></li>
  <li>Other 3rd party system</li>
</ul>

<p>Each of these methods saves data in a different format. Now I’m sure you will have used at least one of these methods in your apps at some point to retrieve / save data.</p>

<p>When not using the repository pattern it is quite common to access and use these elements directly, either in your ViewController or in some other part of your app depending how it is structured.</p>

<h2 id="the-problem">The problem</h2>

<p>What’s the problem with this approach? Your app becomes difficult to maintain. Now if you only have a small app with a few screens then this isn’t much of a problem as there are only a few elements to change.</p>

<p>However, what if you are working on a large app with several developers and lots of code? You could have <a href="https://developer.apple.com/documentation/coredata/nsmanagedobject">NSManagedObjects</a> or <a href="https://developer.apple.com/documentation/swift/codable">Codable</a> objects littered throughout the codebase for example. What happens if you wish to remove Core Data? Perhaps move to realm? You would need to modify all of the classes in your codebase where you had used your Core Data objects.</p>

<p>Similarly, if you are using Codable objects directly from your JSON response. What happens when your backend team changes the API or you switch to a different API provider? The structure of the data may change which means your Codable objects might change. Again you will need to modify a large number of classes if you are working on a large app.</p>

<p>We can also apply this to the other options such as accessing data from 3rd party frameworks. If we use the objects returned from the framework directly, they will all need changing if we change provider or the SDK changes.</p>

<p>There is also the question of query language. Web services use headers and <a href="https://developer.apple.com/documentation/foundation/urlqueryitem">URLQueryItem</a>, Core Data uses <a href="https://developer.apple.com/documentation/foundation/nspredicate">Predicates</a> and so on. Every entry point to query the data must know and understand the underlying query language in order to get the information it once. Again, if this changes we need change every query point to the new format.</p>

<p>Let’s have a look at the diagram below:</p>

<p><img src="/assets/images/core-data-example.png" alt="Core Data Example" title="Core Data Example" /></p>

<p>Here we have an app structure that is making use of Core Data. There is an object that is being used to access the stack that returns some data. Let’s say for this example that it is news articles. These new articles must inherit from NSManagedObject to be used in Core Data. Now if our data layer is returning NSManagedObjects to the rest of our app structure we now have a dependency between Core Data and the rest of the files in our app. If we wish to move to Realm for example, or switch to using some other form of data store we would need to modify all the of files in the app. The app in this example is only small, imagine having to do that for a much bigger app!</p>

<h2 id="domain-objects-and-the-repository">Domain Objects and the Repository</h2>

<p>This is where Domain Objects come in. Domain Objects are value objects that are defined by your application. Rather than using objects and structures defined outside of the app, we define what we want the objects to look like. It’s then up to the repository to map between the data storage object / structure to these value objects.</p>

<p>When we do this, it means any changes to the data access layer, as we discussed earlier such as data structure changes or changes in provider don’t impact the rest of the app. The only part of the app that needs to be updated is the repository and it’s mapping to the domain objects.</p>

<p>The below quote summarises the idea of the pattern:</p>

<blockquote>
  <p>Repositories are classes or components that encapsulate the logic required to access data sources. They centralize common data access functionality, providing better maintainability and decoupling the infrastructure or technology used to access databases from the domain model layer.</p>
</blockquote>

<p>Let’s have a look at our previous example but modified to use the a repository and domain objects:</p>

<p><img src="/assets/images/core-data-example-2.png" alt="Core Data Example 2" title="Core Data Example 2" /></p>

<p>So what is the difference here? As you can see the Core Data stack is still returning NSManagedObjects, however the repository is converting that to a domain object. This object doesn’t inherit from NSManagedObject, also it’s structure and attributes are defined by the app rather than what is in the data store.</p>

<p>Now if we wanted to move away from Core Data to something else the only classes that need to be changed are the Core Data stack and the repository. The rest of the app does not need to be changed as we can map the new data stores type to our domain objects using the repository.</p>

<h2 id="example">Example</h2>

<p>To show a small working example we are going to use a couple of <a href="https://github.com/public-apis/public-apis">Free Public APIs</a> (highly recommend this resource if you are looking to build a demo app or experiment). We will use 2 APIs that returns users. However they return them in a different format.</p>

<p><a href="https://jsonplaceholder.typicode.com/users/1">https://jsonplaceholder.typicode.com/users/1</a></p>

<p><a href="https://randomuser.me/api/">https://randomuser.me/api/</a></p>

<p>As we have done in <a href="/networking/simple-json-decoder-in-swift-and-combine.html">previous blog posts</a> we are going to use <a href="https://app.quicktype.io">QuickType</a> to generate our Codable objects from our JSON response. We will start with our first request.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// MARK: - User</span>
<span class="kd">struct</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">address</span><span class="p">:</span> <span class="kt">Address</span>
    <span class="k">let</span> <span class="nv">phone</span><span class="p">,</span> <span class="nv">website</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">company</span><span class="p">:</span> <span class="kt">Company</span>
<span class="p">}</span>

<span class="c1">// MARK: - Address</span>
<span class="kd">struct</span> <span class="kt">Address</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">street</span><span class="p">,</span> <span class="n">suite</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="nv">zipcode</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">geo</span><span class="p">:</span> <span class="kt">Geo</span>
<span class="p">}</span>

<span class="c1">// MARK: - Geo</span>
<span class="kd">struct</span> <span class="kt">Geo</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">lat</span><span class="p">,</span> <span class="nv">lng</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Company</span>
<span class="kd">struct</span> <span class="kt">Company</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">,</span> <span class="n">catchPhrase</span><span class="p">,</span> <span class="nv">bs</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>This structure will allow us to decode the response from the first request. Let’s make a simple example that takes the response and outputs some data. We will be using code from our <a href="/networking/simple-json-decoder-in-swift-and-combine.html">Simple JSON Decoder</a> to process the output so feel free to read up if the code you see doesn’t make sense.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://jsonplaceholder.typicode.com/users/1"</span><span class="p">)</span><span class="o">!</span>
<span class="c1">// 1</span>
<span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">?,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
	<span class="c1">// 2</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// 3</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">user</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">street</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">city</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">zipcode</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">lng</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span></code></pre></figure>

<p>So let’s step through what’s happening here:</p>

<ol>
  <li>First of all we are making the request using our <a href="/networking/simple-json-decoder-in-swift-and-combine.html">Simple JSON Decoder</a> to return our new User type.</li>
  <li>Output any errors</li>
  <li>So here we are outputting the name, address and location of the user we get back. Super simple right now.</li>
</ol>

<h2 id="managing-change">Managing change</h2>

<p>Now let’s say we change provider. Maybe our backend team changes the API, or we switch data provider or from 2 different data provider SDKs. In our example we will switch from the first url (<a href="https://jsonplaceholder.typicode.com/users/1">https://jsonplaceholder.typicode.com/users/1</a>) to the second (<a href="https://randomuser.me/api/">https://randomuser.me/api/</a>).</p>

<p>The first thing we will need to do is change all of our codable objects as the structure of the response is different. Let’s use QuickType again to give us the new structure:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// MARK: - Users</span>
<span class="kd">struct</span> <span class="kt">Users</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">Result</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">info</span><span class="p">:</span> <span class="kt">Info</span>
<span class="p">}</span>

<span class="c1">// MARK: - Info</span>
<span class="kd">struct</span> <span class="kt">Info</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">seed</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">results</span><span class="p">,</span> <span class="nv">page</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">version</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Result</span>
<span class="kd">struct</span> <span class="kt">Result</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">gender</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">Name</span>
    <span class="k">let</span> <span class="nv">location</span><span class="p">:</span> <span class="kt">Location</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">login</span><span class="p">:</span> <span class="kt">Login</span>
    <span class="k">let</span> <span class="nv">dob</span><span class="p">,</span> <span class="nv">registered</span><span class="p">:</span> <span class="kt">Dob</span>
    <span class="k">let</span> <span class="nv">phone</span><span class="p">,</span> <span class="nv">cell</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">ID</span>
    <span class="k">let</span> <span class="nv">picture</span><span class="p">:</span> <span class="kt">Picture</span>
    <span class="k">let</span> <span class="nv">nat</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Dob</span>
<span class="kd">struct</span> <span class="kt">Dob</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="c1">// MARK: - ID</span>
<span class="kd">struct</span> <span class="kt">ID</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>

<span class="c1">// MARK: - Location</span>
<span class="kd">struct</span> <span class="kt">Location</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">street</span><span class="p">:</span> <span class="kt">Street</span>
    <span class="k">let</span> <span class="nv">city</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="nv">country</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">postcode</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">coordinates</span><span class="p">:</span> <span class="kt">Coordinates</span>
    <span class="k">let</span> <span class="nv">timezone</span><span class="p">:</span> <span class="kt">Timezone</span>
<span class="p">}</span>

<span class="c1">// MARK: - Coordinates</span>
<span class="kd">struct</span> <span class="kt">Coordinates</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">latitude</span><span class="p">,</span> <span class="nv">longitude</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Street</span>
<span class="kd">struct</span> <span class="kt">Street</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">number</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Timezone</span>
<span class="kd">struct</span> <span class="kt">Timezone</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">offset</span><span class="p">,</span> <span class="nv">timezoneDescription</span><span class="p">:</span> <span class="kt">String</span>

    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">offset</span>
        <span class="k">case</span> <span class="n">timezoneDescription</span> <span class="o">=</span> <span class="s">"description"</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Login</span>
<span class="kd">struct</span> <span class="kt">Login</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">uuid</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="nv">salt</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">md5</span><span class="p">,</span> <span class="n">sha1</span><span class="p">,</span> <span class="nv">sha256</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Name</span>
<span class="kd">struct</span> <span class="kt">Name</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="nv">last</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="c1">// MARK: - Picture</span>
<span class="kd">struct</span> <span class="kt">Picture</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">large</span><span class="p">,</span> <span class="n">medium</span><span class="p">,</span> <span class="nv">thumbnail</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>Now this is more complicated that it needs to be for our example but I’m leaving it here as an extreme example of how different things can be. As you can probably tell the structure and types have change dramatically from our first example. So let’s try and output the same data from this example in our previous example. We can ignore the request part and just focus on the data output so we can see the differences:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Request 1 output</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">user</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">street</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">city</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">zipcode</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">lng</span><span class="p">)</span>
<span class="p">}</span>


<span class="c1">// Request 2 output</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">users</span><span class="p">?</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">first</span><span class="se">)</span><span class="s"> </span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">last</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">street</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">city</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">postcode</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>As you can see from even this simple example. We would have to change 7 lines of code, just to produce the same output. Now imagine this change happening on a much bigger project! There could possibly be 100s of lines of code that would need updating, all because the API response has changed.</p>

<h2 id="repository-pattern">Repository Pattern</h2>

<p>Here is where the repository pattern comes in. We can create a user repository that fetches the user and converts it to our domain object. That way we don’t need to update the output.</p>

<p>First thing to do is design our domain object that will represent a User in our system. Now all we are doing in this simple example is outputting a few attributes so let’s design our object with just those attributes as we don’t need the rest.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">DomainUser</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">street</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">postcode</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">latitude</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">longitude</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>Here we have a nice simple representation of our User object. There is no need to consider any of the other possible attributes returned from the API. We aren’t using them in our application and they will just sit around taking up valuable memory. You will also notice that this object doesn’t conform to Codable or subclass NSManagedObject. This is because DomainObject should not contain any knowledge about how they are stored. That is the responsibility of the repository.</p>

<p>To design our repository we can make use of Generics and Protocols to design a repository we can use for anything, not just our DomainUser. Let take a look:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="kt">Repository</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">T</span>
    
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="kt">T</span><span class="p">?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">list</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="p">([</span><span class="kt">T</span><span class="p">]?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">delete</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">edit</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">CombineRepository</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">T</span>
    
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span>
    <span class="kd">func</span> <span class="nf">list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">T</span><span class="p">],</span> <span class="kt">Error</span><span class="o">&gt;</span>
    <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Void</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span>
    <span class="kd">func</span> <span class="nf">delete</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Void</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span>
    <span class="kd">func</span> <span class="nf">edit</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Void</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span>
<span class="p">}</span></code></pre></figure>

<p>Here we have different functions for all of the operations we can do. What you will notice is that none of these functions specify where or how the data is stored. Remember when we talked about different storage options at the beginning? We could implement a repo that talks to an API (like in our example), one that stores things in Core Data or one that writes to UserDefaults. It’s up to the repository that implements the protocol to decide these details, all we care about is that we can load and save the data from somewhere.</p>

<h2 id="see-it-action">See it action</h2>

<p>Now we have defined what the repository pattern is, let’s create 2 implementations. One for our first request and one for the second. Both should return domain objects, rather than the type returned from the request.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// 1</span>
<span class="kd">enum</span> <span class="kt">RepositoryError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">notFound</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">FirstRequestImp</span><span class="p">:</span> <span class="kt">Repository</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">T</span> <span class="o">=</span> <span class="kt">DomainUser</span>
    
    <span class="c1">// 2</span>
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">DomainUser</span><span class="p">?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://jsonplaceholder.typicode.com/users/1"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">?,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="k">guard</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">user</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="kt">RepositoryError</span><span class="o">.</span><span class="n">notFound</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="c1">// 3</span>
            <span class="k">let</span> <span class="nv">domainUser</span> <span class="o">=</span> <span class="kt">DomainUser</span><span class="p">(</span>
                <span class="nv">name</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nv">street</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">street</span><span class="p">,</span>
                <span class="nv">city</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>
                <span class="nv">postcode</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">zipcode</span><span class="p">,</span>
                <span class="nv">latitude</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
                <span class="nv">longitude</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">lng</span>
            <span class="p">)</span>
            
            <span class="nf">completionHandler</span><span class="p">(</span><span class="n">domainUser</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>
    
     <span class="c1">// 4</span>
    <span class="kd">func</span> <span class="nf">list</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">DomainUser</span><span class="p">]?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">DomainUser</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">delete</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">DomainUser</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">edit</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">DomainUser</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">SecondRequestImp</span><span class="p">:</span> <span class="kt">Repository</span> <span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">T</span> <span class="o">=</span> <span class="kt">DomainUser</span>
    
    <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">DomainUser</span><span class="p">?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://randomuser.me/api/"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">users</span><span class="p">:</span> <span class="kt">Users</span><span class="p">?,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="k">guard</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">users</span><span class="p">?</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">first</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="kt">RepositoryError</span><span class="o">.</span><span class="n">notFound</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            
            <span class="c1">// 5</span>
            <span class="k">let</span> <span class="nv">domainUser</span> <span class="o">=</span> <span class="kt">DomainUser</span><span class="p">(</span>
                <span class="nv">name</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">first</span><span class="se">)</span><span class="s"> </span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">last</span><span class="se">)</span><span class="s">"</span><span class="p">,</span>
                <span class="nv">street</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">street</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nv">city</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">city</span><span class="p">,</span>
                <span class="nv">postcode</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">postcode</span><span class="se">)</span><span class="s">"</span><span class="p">,</span>
                <span class="nv">latitude</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                <span class="nv">longitude</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">longitude</span>
            <span class="p">)</span>
            
            <span class="nf">completionHandler</span><span class="p">(</span><span class="n">domainUser</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">list</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">DomainUser</span><span class="p">]?,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">DomainUser</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">delete</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">DomainUser</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">edit</span><span class="p">(</span><span class="n">_</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">DomainUser</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></figure>

<p>There’s quite a bit of code here so let’s step through it.</p>

<ol>
  <li>First of all we have defined a new error to send back if we don’t receive any user info from the API.</li>
  <li>This is the same call we made in our example before.</li>
  <li>Now here we are taking the returned Codable User and converting it to your new DomainUser class.</li>
  <li>We aren’t implementing the other functions in this example so just leaving them empty for now to remove errors.</li>
  <li>This struct is the second request we are making, and again here we are mapping our Users Codable type from the second request to our DomainUser.</li>
</ol>

<p>Now that we have made our two repositories, let’s show how we can quickly switch between them without breaking / changing code.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">repository</span><span class="p">:</span> <span class="kt">FirstRequestImp</span> <span class="o">=</span> <span class="kt">FirstRequestImp</span><span class="p">()</span>
<span class="n">repository</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">user</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">street</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">city</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">postcode</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Here is our example from earlier in the article but updated to use our new repositories. Here we go and fetch the user and print their details, the same as before. Now below we can switch to our second request and see how that will work.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">repository</span><span class="p">:</span> <span class="kt">SecondRequestImp</span> <span class="o">=</span> <span class="kt">SecondRequestImp</span><span class="p">()</span>
<span class="n">repository</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="n">user</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">street</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">city</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">postcode</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Now notice how the only part we changed was the implementation class? The rest of the code remained the same even though where the data was coming from has changed and is coming back in a completely different structure. Now imagine we are using this repo in many places to fetch user details. We can quickly switch between different data sources without changing the code that uses it. The only changes we have to make are to the repo and to the data mapping code. So only one change rather than a change in every single class that uses these objects.</p>

<h2 id="conclusion">Conclusion</h2>

<p>So let’s recap what we have discussed here:</p>

<ul>
  <li>First of all we discussed the problem of using data storage classes throughout your codebase. Especially on large projects if you need to switch data source / structure.</li>
  <li>We then discussed how using the repository pattern and mapping to domain objects rather than using data storage classes can make your code easier to change in the future.</li>
  <li>We worked through some examples of how changing API structures can impact your code.</li>
  <li>We then implemented a basic repository pattern with mapping to domain objects to show how doing this can make updating your project easier.</li>
</ul>

<p>Finally let’s discuss the pros and cons of the approach:</p>

<h3 id="advantages">Advantages</h3>

<ul>
  <li>Code is easier to change if you need to switch data source or structure</li>
  <li>Separates concerns of where / how data is stored away from the rest of your app</li>
</ul>

<h3 id="disadvantages">Disadvantages</h3>

<ul>
  <li>Adds more code and complexity</li>
  <li>Need to write mappers for each object to domain objects</li>
  <li>Not really needed on smaller solo projects</li>
</ul>

<p>Feel free to <a href="https://github.com/pyartez/blog-samples">download the playground</a> and play around with the examples yourself</p>


                
                    <p><a href="/architecture/repository-pattern-in-swift-and-combine.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Repository Pattern in Swift&p[summary]=Background

All apps developed require data of some description. This data is stored somewhere, could be on the device itself, in a remot...&p[url]=https://pyartez.github.io/architecture/repository-pattern-in-swift-and-combine.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://pyartez.github.io/architecture/repository-pattern-in-swift-and-combine.html&text=Background

All apps developed require data of some description. This data is stored somewhere, could be on the device itself, in a remot...&hashtags=swift,combine,generics,architecture," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://pyartez.github.io/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://pyartez.github.io/tag/swift">swift</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/combine">combine</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/generics">generics</a></li>
                        
                        <li><a href="https://pyartez.github.io/tag/architecture">architecture</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959344114005358"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5w+4e-db+86"
     data-ad-client="ca-pub-6959344114005358"
     data-ad-slot="8843896136"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
    

    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

            </main>
        </div>

        <script src="https://pyartez.github.io/assets/js/jquery-1.12.2.min.js"></script>
<script src="https://pyartez.github.io/assets/js/backtotop.js"></script>
<script src="https://pyartez.github.io/assets/js/lunr.min.js"></script>
<script src="https://pyartez.github.io/assets/js/lunr-feed.js"></script>
<script src="https://pyartez.github.io/assets/js/jquery.fitvids.js"></script>
<script src="https://pyartez.github.io/assets/js/svg4everybody.min.js"></script>
<script src="https://pyartez.github.io/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-163798308-1', 'auto');
        ga('send', 'pageview');
    </script>

    </body>
</html>